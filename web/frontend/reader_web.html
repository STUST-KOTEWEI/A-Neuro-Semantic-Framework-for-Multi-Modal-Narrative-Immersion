<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Reader - ç¶²é ç‰ˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    header p {
      opacity: 0.9;
      font-size: 1.1rem;
    }
    
    nav {
      background: #f8f9fa;
      padding: 15px 30px;
      display: flex;
      gap: 10px;
      border-bottom: 2px solid #e9ecef;
    }
    
    nav button {
      padding: 10px 20px;
      border: none;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    nav button:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }
    
    nav button.active {
      background: #667eea;
      color: white;
    }
    
    main {
      padding: 30px;
    }
    
    .content-area {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .display-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      min-height: 400px;
    }
    
    .display-section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .image-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .image-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }
    
    .image-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    .image-card .info {
      padding: 10px;
      font-size: 0.9rem;
    }
    
    .control-panel {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
    }
    
    .control-panel h3 {
      color: #667eea;
      margin-bottom: 15px;
    }
    
    .feature-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .feature-btn {
      padding: 15px;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .feature-btn:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .permission-section {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      border: 2px dashed #667eea;
    }
    
    .permission-btn {
      padding: 10px 15px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 5px;
      transition: all 0.3s;
    }
    
    .permission-btn:hover {
      background: #667eea;
      color: white;
    }
    
    .permission-btn.granted {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }
    
    .debug-log {
      background: #1e293b;
      color: #94a3b8;
      padding: 20px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 20px;
    }
    
    .alert {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: 600;
      display: none;
    }
    
    .alert.success {
      background: #d1fae5;
      color: #065f46;
      border: 2px solid #10b981;
    }
    
    .alert.error {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #ef4444;
    }
    
    .video-preview {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      margin-top: 15px;
      display: none;
    }
    
    #canvas {
      display: none;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .data-table th {
      background: #667eea;
      color: white;
      padding: 12px;
      text-align: left;
    }
    
    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .data-table tr:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸš€ Modern Reader</h1>
      <p>ç¾ä»£é–±è®€ â€¢ æ™ºèƒ½åˆ†æ â€¢ å¤šæ„Ÿå®˜é«”é©—</p>
    </header>
    
    <nav>
      <button id="navHome" class="active">ğŸ  é¦–é </button>
      <button id="navFeatures">âš¡ åŠŸèƒ½</button>
      <button id="navSettings">âš™ï¸ è¨­å®š</button>
    </nav>
    
    <main>
      <div id="alertBox" class="alert"></div>
      
      <!-- é¦–é  -->
      <div id="pageHome">
        <h2 style="color: #667eea; font-size: 2rem; margin-bottom: 20px;">æ­¡è¿ä½¿ç”¨ Modern Reader</h2>
        <p style="font-size: 1.1rem; line-height: 1.8; color: #4b5563;">
          æœ¬å¹³å°æä¾›å¤šæ„Ÿå®˜ AI é–±è®€é«”é©—ï¼Œæ”¯æ´ NLP åˆ†æã€RAG æœåœ–ã€èªéŸ³éŒ„éŸ³/æ’­æ”¾ã€ISBN å°é¢æŸ¥è©¢èˆ‡æ•¸æ“šè¨˜éŒ„ã€‚
          å¯ç›´æ¥ä½¿ç”¨å„é …åŠŸèƒ½ï¼Œæˆ–è«‹æ±‚ç›¸æ©Ÿã€éº¥å…‹é¢¨æ¬Šé™ä»¥è§£é–æ›´å¤šäº’å‹•é«”é©—ã€‚
        </p>
        
        <div class="permission-section">
          <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“± è£ç½®æ¬Šé™</h3>
          <p style="margin-bottom: 15px; color: #6b7280;">è«‹æ±‚ä½¿ç”¨è£ç½®åŠŸèƒ½ä»¥æå‡é«”é©—ï¼š</p>
          <button id="btnRequestCamera" class="permission-btn">ğŸ“· è«‹æ±‚ç›¸æ©Ÿæ¬Šé™</button>
          <button id="btnRequestMicrophone" class="permission-btn">ğŸ¤ è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™</button>
          <video id="videoPreview" class="video-preview" autoplay></video>
          <canvas id="canvas"></canvas>
        </div>
      </div>
      
      <!-- åŠŸèƒ½é é¢ -->
      <div id="pageFeatures" style="display: none;">
        <div class="content-area">
          <div class="display-section">
            <h2 id="displayTitle">ğŸ“Š é¡¯ç¤ºå€åŸŸ</h2>
            <div id="displayContent">
              <p style="color: #6b7280;">é»æ“Šå³å´åŠŸèƒ½æŒ‰éˆ•æŸ¥çœ‹å…§å®¹...</p>
            </div>
          </div>
          
          <div class="control-panel">
            <h3>âš¡ åŠŸèƒ½é¸å–®</h3>
            <div class="feature-buttons">
              <button class="feature-btn" id="btnNLP">ğŸ“ NLPåˆ†æ</button>
              <button class="feature-btn" id="btnRAG">ğŸ” RAGæœåœ–</button>
              <button class="feature-btn" id="btnSTT">ğŸ™ï¸ STTæƒ…æ„Ÿåµæ¸¬</button>
              <button class="feature-btn" id="btnTTS">ğŸ”Š TTSæ’­å®¢å…§å®¹</button>
              <button class="feature-btn" id="btnISBN">ğŸ“š ISBNæ›¸ç±å°é¢</button>
              <button class="feature-btn" id="btnData">ğŸ“Š ç”¨æˆ¶æ•¸æ“š</button>
            </div>
          </div>
        </div>
        
        <div class="debug-log" id="debugLog">è¼‰å…¥ä¸­...</div>
      </div>
      
      <!-- è¨­å®šé é¢ -->
      <div id="pageSettings" style="display: none;">
        <h2 style="color: #667eea; font-size: 2rem; margin-bottom: 20px;">âš™ï¸ è¨­å®š</h2>
        <p style="color: #6b7280;">åŠŸèƒ½é–‹ç™¼ä¸­...</p>
      </div>
    </main>
  </div>
  
  <script>
    const $ = s => document.querySelector(s);
    const log = (...args) => {
      const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
      $('#debugLog').textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
      $('#debugLog').scrollTop = $('#debugLog').scrollHeight;
    };
    
    const showAlert = (msg, type = 'error') => {
      const alert = $('#alertBox');
      alert.textContent = msg;
      alert.className = `alert ${type}`;
      alert.style.display = 'block';
      setTimeout(() => alert.style.display = 'none', 5000);
    };
    
    const API_BASE = window.location.port === '8010' ? '' : 'http://localhost:8010';
    let cameraStream = null;
    let audioStream = null;
    
    // å°èˆªåŠŸèƒ½
    $('#navHome').addEventListener('click', () => {
      $('#pageHome').style.display = 'block';
      $('#pageFeatures').style.display = 'none';
      $('#pageSettings').style.display = 'none';
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      $('#navHome').classList.add('active');
    });
    
    $('#navFeatures').addEventListener('click', () => {
      $('#pageHome').style.display = 'none';
      $('#pageFeatures').style.display = 'block';
      $('#pageSettings').style.display = 'none';
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      $('#navFeatures').classList.add('active');
      log('é€²å…¥åŠŸèƒ½é é¢');
    });
    
    $('#navSettings').addEventListener('click', () => {
      $('#pageHome').style.display = 'none';
      $('#pageFeatures').style.display = 'none';
      $('#pageSettings').style.display = 'block';
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      $('#navSettings').classList.add('active');
    });
    
    // ç›¸æ©Ÿæ¬Šé™è«‹æ±‚
    $('#btnRequestCamera').addEventListener('click', async () => {
      try {
        log('è«‹æ±‚ç›¸æ©Ÿæ¬Šé™...');
        cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
        $('#videoPreview').srcObject = cameraStream;
        $('#videoPreview').style.display = 'block';
        $('#btnRequestCamera').classList.add('granted');
        $('#btnRequestCamera').textContent = 'âœ… ç›¸æ©Ÿå·²æˆæ¬Š';
        log('âœ… ç›¸æ©Ÿæ¬Šé™å·²æˆäºˆ');
        showAlert('ç›¸æ©Ÿæ¬Šé™å·²æˆäºˆ', 'success');
      } catch (e) {
        log('âŒ ç›¸æ©Ÿæ¬Šé™è¢«æ‹’çµ•:', e.message);
        showAlert('ç›¸æ©Ÿæ¬Šé™è¢«æ‹’çµ•', 'error');
      }
    });
    
    // éº¥å…‹é¢¨æ¬Šé™è«‹æ±‚
    $('#btnRequestMicrophone').addEventListener('click', async () => {
      try {
        log('è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™...');
        audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        $('#btnRequestMicrophone').classList.add('granted');
        $('#btnRequestMicrophone').textContent = 'âœ… éº¥å…‹é¢¨å·²æˆæ¬Š';
        log('âœ… éº¥å…‹é¢¨æ¬Šé™å·²æˆäºˆ');
        showAlert('éº¥å…‹é¢¨æ¬Šé™å·²æˆäºˆ', 'success');
      } catch (e) {
        log('âŒ éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•:', e.message);
        showAlert('éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•', 'error');
      }
    });
    
    // NLP åˆ†æ
    $('#btnNLP').addEventListener('click', async () => {
      log('è¼‰å…¥ NLP åˆ†æçµæœ...');
      try {
        const resp = await fetch(`${API_BASE}/data/nlp`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ“ NLP åˆ†æçµæœ</h3>';
        html += '<table class="data-table"><tr><th>æ–‡æœ¬</th><th>é¡å‹</th><th>çµæœ</th></tr>';
        data.data.forEach(item => {
          html += `<tr>
            <td>${item.text}</td>
            <td>${item.analysis_type}</td>
            <td><pre style="margin:0;">${JSON.stringify(item.result, null, 2)}</pre></td>
          </tr>`;
        });
        html += '</table>';
        
        $('#displayTitle').textContent = 'ğŸ“ NLP åˆ†æçµæœ';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} ç­† NLP åˆ†æ`);
        showAlert(`è¼‰å…¥ ${data.data.length} ç­†åˆ†æçµæœ`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥ NLP æ•¸æ“šå¤±æ•—', 'error');
      }
    });
    
    // RAG æœåœ–
    $('#btnRAG').addEventListener('click', async () => {
      log('è¼‰å…¥ RAG åœ–åƒ...');
      try {
        const resp = await fetch(`${API_BASE}/data/rag-images`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ” RAG æœåœ–çµæœ</h3>';
        html += '<div class="image-grid">';
        data.data.forEach(item => {
          html += `
            <div class="image-card">
              <img src="${item.image_url}" alt="${item.description}" onerror="this.src='https://via.placeholder.com/200x200?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—'">
              <div class="info">
                <strong>${item.query}</strong><br>
                <small>${item.description}</small><br>
                <small>ç›¸é—œåº¦: ${(item.relevance_score * 100).toFixed(0)}%</small>
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        $('#displayTitle').textContent = 'ğŸ” RAG æœåœ–çµæœ';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} å¼µåœ–åƒ`);
        showAlert(`è¼‰å…¥ ${data.data.length} å¼µåœ–åƒ`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥åœ–åƒå¤±æ•—', 'error');
      }
    });
    
    // STT æƒ…æ„Ÿåµæ¸¬
    $('#btnSTT').addEventListener('click', async () => {
      log('è¼‰å…¥æƒ…æ„Ÿåµæ¸¬çµæœ...');
      try {
        const resp = await fetch(`${API_BASE}/data/emotions`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ™ï¸ æƒ…æ„Ÿåµæ¸¬çµæœ</h3>';
        html += '<table class="data-table"><tr><th>æ–‡æœ¬</th><th>æƒ…æ„Ÿ</th><th>ä¿¡å¿ƒåº¦</th></tr>';
        data.data.forEach(item => {
          html += `<tr>
            <td>${item.audio_text}</td>
            <td><strong>${item.emotion}</strong></td>
            <td>${(item.confidence * 100).toFixed(1)}%</td>
          </tr>`;
        });
        html += '</table>';
        
        $('#displayTitle').textContent = 'ğŸ™ï¸ æƒ…æ„Ÿåµæ¸¬çµæœ';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} ç­†æƒ…æ„Ÿæ•¸æ“š`);
        showAlert(`è¼‰å…¥ ${data.data.length} ç­†æƒ…æ„Ÿæ•¸æ“š`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥æƒ…æ„Ÿæ•¸æ“šå¤±æ•—', 'error');
      }
    });
    
    // TTS æ’­å®¢å…§å®¹
    $('#btnTTS').addEventListener('click', async () => {
      log('è¼‰å…¥æ’­å®¢å…§å®¹...');
      try {
        const resp = await fetch(`${API_BASE}/data/podcasts`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ”Š æ’­å®¢å…§å®¹åˆ—è¡¨</h3>';
        html += '<table class="data-table"><tr><th>æ¨™é¡Œ</th><th>å…§å®¹</th><th>æ™‚é•·</th></tr>';
        data.data.forEach(item => {
          const minutes = Math.floor(item.duration / 60);
          const seconds = item.duration % 60;
          html += `<tr>
            <td><strong>${item.title}</strong></td>
            <td>${item.content}</td>
            <td>${minutes}:${seconds.toString().padStart(2, '0')}</td>
          </tr>`;
        });
        html += '</table>';
        
        $('#displayTitle').textContent = 'ğŸ”Š æ’­å®¢å…§å®¹åˆ—è¡¨';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} å€‹æ’­å®¢`);
        showAlert(`è¼‰å…¥ ${data.data.length} å€‹æ’­å®¢`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥æ’­å®¢å…§å®¹å¤±æ•—', 'error');
      }
    });
    
    // ISBN æ›¸ç±å°é¢
    $('#btnISBN').addEventListener('click', async () => {
      log('è¼‰å…¥æ›¸ç±å°é¢...');
      try {
        const resp = await fetch(`${API_BASE}/data/book-covers`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ“š æ›¸ç±å°é¢åˆ—è¡¨</h3>';
        html += '<div class="image-grid">';
        data.data.forEach(item => {
          html += `
            <div class="image-card">
              <img src="${item.cover_image_url}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/200x300?text=å°é¢è¼‰å…¥å¤±æ•—'">
              <div class="info">
                <strong>${item.title}</strong><br>
                <small>${item.author}</small><br>
                <small>ISBN: ${item.isbn}</small>
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        $('#displayTitle').textContent = 'ğŸ“š æ›¸ç±å°é¢åˆ—è¡¨';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} æœ¬æ›¸ç±`);
        showAlert(`è¼‰å…¥ ${data.data.length} æœ¬æ›¸ç±å°é¢`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥æ›¸ç±å°é¢å¤±æ•—', 'error');
      }
    });
    
    // ç”¨æˆ¶æ•¸æ“š
    $('#btnData').addEventListener('click', async () => {
      log('è¼‰å…¥ç”¨æˆ¶æ•¸æ“š...');
      try {
        const resp = await fetch(`${API_BASE}/data/users`);
        const data = await resp.json();
        
        let html = '<h3 style="color: #667eea;">ğŸ“Š ç”¨æˆ¶æ•¸æ“šåˆ—è¡¨</h3>';
        html += '<table class="data-table"><tr><th>ID</th><th>ç”¨æˆ¶å</th><th>Email</th><th>è¨‚é–±æ–¹æ¡ˆ</th></tr>';
        data.data.forEach(item => {
          html += `<tr>
            <td>${item.id}</td>
            <td><strong>${item.username}</strong></td>
            <td>${item.email}</td>
            <td><span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 4px;">${item.subscription_tier}</span></td>
          </tr>`;
        });
        html += '</table>';
        
        $('#displayTitle').textContent = 'ğŸ“Š ç”¨æˆ¶æ•¸æ“šåˆ—è¡¨';
        $('#displayContent').innerHTML = html;
        log(`âœ… è¼‰å…¥ ${data.data.length} ç­†ç”¨æˆ¶æ•¸æ“š`);
        showAlert(`è¼‰å…¥ ${data.data.length} ç­†ç”¨æˆ¶æ•¸æ“š`, 'success');
      } catch (e) {
        log('âŒ è¼‰å…¥å¤±æ•—:', e.message);
        showAlert('è¼‰å…¥ç”¨æˆ¶æ•¸æ“šå¤±æ•—', 'error');
      }
    });
    
    log('Modern Reader ç¶²é ç‰ˆå·²è¼‰å…¥');
    log(`API åŸºç¤è·¯å¾‘: ${API_BASE || '(ç›¸å°è·¯å¾‘)'}`);
  </script>
</body>
</html>
